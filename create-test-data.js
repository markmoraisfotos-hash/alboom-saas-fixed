// PhotoFlow SaaS - Script para criar dados de teste
const { Photo, Session } = require('./models/Photo');
const { Order, Package, Payment } = require('./models/Order');
const User = require('./models/User');

async function createTestData() {
    console.log('üì∏ Criando dados de teste para PhotoFlow SaaS...\n');

    try {
        // 1. Criar fot√≥grafo de teste
        console.log('üë®‚Äçüíº Criando fot√≥grafo de teste...');
        const photographer = await User.create({
            name: 'Jo√£o Fot√≥grafo',
            email: 'joao@photoflow.com',
            password: 'fotografo123',
            role: 'user'
        });
        console.log('‚úÖ Fot√≥grafo criado:', photographer.email);

        // 2. Criar sess√£o de teste  
        console.log('\nüìÅ Criando sess√£o de teste...');
        const session = Session.create({
            photographer_id: photographer.id,
            name: 'Casamento Ana & Carlos - Ensaio',
            description: 'Ensaio pr√©-casamento no Parque Ibirapuera',
            client_name: 'Ana Silva',
            client_email: 'ana@email.com',
            session_date: new Date('2024-12-15T14:30:00Z'),
            max_album_selections: 25,
            max_editing_selections: 8
        });
        console.log('‚úÖ Sess√£o criada:', session.name);
        console.log('üîë C√≥digo de acesso:', session.access_code);
        console.log('üîó URL para cliente:', `/gallery/${session.access_code}`);

        // 3. Adicionar fotos de teste
        console.log('\nüì∏ Adicionando fotos de teste...');
        const testPhotos = [
            {
                filename: 'ANA_CARLOS_001.jpg',
                original_filename: 'DSC_0001.NEF',
                file_size: 2048576,
                dimensions: { width: 1920, height: 1280 },
                metadata: { 
                    camera: 'Nikon D850', 
                    lens: '85mm f/1.4', 
                    iso: 200,
                    aperture: 'f/1.8',
                    shutter: '1/200s'
                }
            },
            {
                filename: 'ANA_CARLOS_002.jpg',
                original_filename: 'DSC_0002.NEF',
                file_size: 2156544,
                dimensions: { width: 1920, height: 1280 },
                metadata: { 
                    camera: 'Nikon D850', 
                    lens: '85mm f/1.4', 
                    iso: 250,
                    aperture: 'f/2.0',
                    shutter: '1/160s'
                }
            },
            {
                filename: 'ANA_CARLOS_003.jpg',
                original_filename: 'DSC_0003.NEF',
                file_size: 1987654,
                dimensions: { width: 1920, height: 1280 },
                metadata: { 
                    camera: 'Nikon D850', 
                    lens: '24-70mm f/2.8', 
                    iso: 400,
                    aperture: 'f/2.8',
                    shutter: '1/125s'
                }
            },
            {
                filename: 'ANA_CARLOS_004.jpg',
                original_filename: 'DSC_0004.NEF',
                file_size: 2234123,
                dimensions: { width: 1920, height: 1280 },
                metadata: { 
                    camera: 'Nikon D850', 
                    lens: '24-70mm f/2.8', 
                    iso: 320,
                    aperture: 'f/3.2',
                    shutter: '1/100s'
                }
            },
            {
                filename: 'ANA_CARLOS_005.jpg',
                original_filename: 'DSC_0005.NEF',
                file_size: 2098765,
                dimensions: { width: 1920, height: 1280 },
                metadata: { 
                    camera: 'Nikon D850', 
                    lens: '70-200mm f/2.8', 
                    iso: 500,
                    aperture: 'f/2.8',
                    shutter: '1/200s'
                }
            },
            {
                filename: 'ANA_CARLOS_006.jpg',
                original_filename: 'DSC_0006.NEF',
                file_size: 2345678,
                dimensions: { width: 1920, height: 1280 },
                metadata: { 
                    camera: 'Nikon D850', 
                    lens: '70-200mm f/2.8', 
                    iso: 400,
                    aperture: 'f/3.5',
                    shutter: '1/160s'
                }
            },
            {
                filename: 'ANA_CARLOS_007.jpg',
                original_filename: 'DSC_0007.NEF',
                file_size: 1876543,
                dimensions: { width: 1920, height: 1280 },
                metadata: { 
                    camera: 'Nikon D850', 
                    lens: '50mm f/1.4', 
                    iso: 200,
                    aperture: 'f/1.6',
                    shutter: '1/250s'
                }
            },
            {
                filename: 'ANA_CARLOS_008.jpg',
                original_filename: 'DSC_0008.NEF',
                file_size: 2123456,
                dimensions: { width: 1920, height: 1280 },
                metadata: { 
                    camera: 'Nikon D850', 
                    lens: '50mm f/1.4', 
                    iso: 160,
                    aperture: 'f/1.8',
                    shutter: '1/320s'
                }
            }
        ];

        testPhotos.forEach((photoData, index) => {
            const photo = Photo.create({
                session_id: session.id,
                photographer_id: photographer.id,
                filename: photoData.filename,
                original_filename: photoData.original_filename,
                file_path: `/uploads/${session.id}/${photoData.filename}`,
                thumbnail_path: `/thumbnails/${session.id}/${photoData.filename}`,
                file_size: photoData.file_size,
                dimensions: photoData.dimensions,
                metadata: photoData.metadata
            });
            console.log(`  ‚úÖ Foto ${index + 1}:`, photo.filename);
        });

        // 4. Simular algumas sele√ß√µes do cliente
        console.log('\nüë• Simulando sele√ß√µes do cliente...');
        const photos = Photo.findBySession(session.id);
        
        // Selecionar algumas fotos para √°lbum
        photos[0].updateSelection({ selected_for_album: true, client_notes: 'Foto perfeita para capa do √°lbum!' });
        photos[2].updateSelection({ selected_for_album: true, client_notes: 'Adoramos esta pose' });
        photos[4].updateSelection({ selected_for_album: true });
        
        // Selecionar algumas para edi√ß√£o
        photos[1].updateSelection({ selected_for_editing: true, client_notes: 'Gostaria de clarear o fundo um pouco' });
        photos[3].updateSelection({ selected_for_editing: true, client_notes: 'Pode remover aquela pessoa no fundo?' });
        
        // Sele√ß√µes gerais
        photos[5].updateSelection({ selected_by_client: true, client_notes: 'Gostamos muito!' });
        photos[6].updateSelection({ selected_by_client: true });

        console.log('‚úÖ Sele√ß√µes simuladas com sucesso');

        // 6. Criar pacotes de venda
        console.log('\nüì¶ Criando pacotes de venda...');
        
        const digitalPackage = Package.create({
            photographer_id: photographer.id,
            name: 'Pacote Digital Premium',
            description: 'Todas as fotos editadas em alta resolu√ß√£o',
            type: 'digital',
            price: 299.90,
            options: {
                photo_count: 'all_selected',
                resolution: 'alta',
                formats: ['JPG', 'PNG']
            }
        });
        
        const printPackage = Package.create({
            photographer_id: photographer.id,
            name: '√Ålbum Cl√°ssico',
            description: '√Ålbum f√≠sico 25x25cm com 15 p√°ginas',
            type: 'print',
            price: 399.90,
            options: {
                size: '25x25cm',
                pages: 15,
                cover: 'capa dura'
            }
        });
        
        const extraPackage = Package.create({
            photographer_id: photographer.id,
            name: 'Fotos Extras',
            description: 'Fotos adicionais editadas',
            type: 'extra_photo',
            price: 35.00,
            options: {
                per_photo: true,
                editing_included: true
            }
        });
        
        console.log('‚úÖ Pacotes criados:', digitalPackage.name, printPackage.name, extraPackage.name);
        
        // 7. Criar pedido de exemplo
        console.log('\nüõí Criando pedido de exemplo...');
        
        const order = Order.create({
            session_id: session.id,
            client_name: session.client_name,
            client_email: session.client_email,
            photographer_id: photographer.id,
            order_type: 'selection',
            items: [
                {
                    package_id: digitalPackage.id,
                    package_name: digitalPackage.name,
                    quantity: 1,
                    unit_price: digitalPackage.price,
                    total: digitalPackage.price,
                    options: { selected_photos: [1, 3, 5] }
                },
                {
                    package_id: extraPackage.id,
                    package_name: extraPackage.name,
                    quantity: 2,
                    unit_price: extraPackage.price,
                    total: extraPackage.price * 2,
                    options: { photo_ids: [2, 4] }
                }
            ],
            subtotal: digitalPackage.price + (extraPackage.price * 2),
            tax: (digitalPackage.price + (extraPackage.price * 2)) * 0.1,
            total: (digitalPackage.price + (extraPackage.price * 2)) * 1.1,
            delivery_method: 'both',
            deadline: new Date(Date.now() + 14 * 24 * 60 * 60 * 1000) // 14 dias
        });
        
        console.log('‚úÖ Pedido criado:', order.id, 'Total:', order.total.toFixed(2));
        
        // 8. Simular pagamento
        console.log('\nüí≥ Simulando pagamento...');
        
        const payment = order.processPayment({
            method: 'credit_card',
            gateway: 'stripe',
            transaction_id: 'txn_' + Date.now()
        });
        
        console.log('‚úÖ Pagamento processado:', payment.amount.toFixed(2));

        // 5. Mostrar resumo
        console.log('\nüìä RESUMO DOS DADOS CRIADOS:');
        console.log('================================');
        console.log('üë®‚Äçüíº Fot√≥grafo:', photographer.name, `(${photographer.email})`);
        console.log('üìÅ Sess√£o:', session.name);
        console.log('üîë C√≥digo de acesso:', session.access_code);
        console.log('üì∏ Total de fotos:', testPhotos.length);
        
        const stats = Photo.getSessionStats(session.id);
        console.log('üìä Estat√≠sticas da Galeria:');
        console.log(`   ‚Ä¢ Selecionadas para √°lbum: ${stats.selected_for_album}`);
        console.log(`   ‚Ä¢ Selecionadas para edi√ß√£o: ${stats.selected_for_editing}`);
        console.log(`   ‚Ä¢ Selecionadas pelo cliente: ${stats.selected_by_client}`);
        console.log(`   ‚Ä¢ Pendentes: ${stats.pending_selection}`);
        
        console.log('\nüí∞ Estat√≠sticas Comerciais:');
        console.log(`   ‚Ä¢ Pacotes criados: 3`);
        console.log(`   ‚Ä¢ Pedidos: 1`);
        console.log(`   ‚Ä¢ Receita: R$ ${order.total.toFixed(2)}`);
        console.log(`   ‚Ä¢ Status pagamento: ${order.payment_status}`);

        console.log('\nüîó URLs para teste:');
        console.log('   === GALERIA ===');
        console.log(`   ‚Ä¢ Dashboard: /api/gallery/dashboard`);
        console.log(`   ‚Ä¢ Galeria cliente: /api/gallery/session/${session.access_code}`);
        console.log(`   ‚Ä¢ Resumo sele√ß√£o: /api/client/${session.access_code}/summary`);
        console.log(`   ‚Ä¢ Finalizar sele√ß√£o: POST /api/client/${session.access_code}/finalize`);
        console.log('   === COM√âRCIO ===');
        console.log(`   ‚Ä¢ Dashboard comercial: /api/commerce/dashboard`);
        console.log(`   ‚Ä¢ Pacotes dispon√≠veis: /api/commerce/session/${session.access_code}/packages`);
        console.log(`   ‚Ä¢ Pedidos: /api/commerce/orders`);
        console.log('   === MARCA D\'AGUA ===');
        console.log(`   ‚Ä¢ Configura√ß√µes: /api/watermark/settings`);
        console.log(`   ‚Ä¢ Pr√©via: /api/watermark/preview`);
        console.log(`   ‚Ä¢ Login fot√≥grafo: joao@photoflow.com / fotografo123`);
        
        console.log('\nüìã FLUXO COMPLETO DA PLATAFORMA:');
        console.log('1. Fot√≥grafo configura marca d\'agua e cria pacotes');
        console.log('2. Fot√≥grafo faz upload das fotos JPEG com marca d\'agua');
        console.log('3. Cliente acessa galeria e seleciona fotos favoritas');
        console.log('4. Cliente compra pacotes e processa pagamento');
        console.log('5. Cliente finaliza ‚Üí gera filtro Lightroom autom√°tico');
        console.log('6. Fot√≥grafo usa filtro no LR ‚Üí edita apenas RAWs selecionados');
        console.log('7. Fot√≥grafo entrega fotos finais em alta resolu√ß√£o!');
        console.log('8. üí∞ Controle total de vendas, prazos e entregas');

        console.log('\n‚úÖ Dados de teste criados com sucesso!');
        
        return {
            photographer,
            session,
            stats,
            packages: [digitalPackage, printPackage, extraPackage],
            order,
            payment
        };

    } catch (error) {
        console.error('‚ùå Erro ao criar dados de teste:', error.message);
        throw error;
    }
}

// Executar se chamado diretamente
if (require.main === module) {
    createTestData()
        .then(() => process.exit(0))
        .catch(err => {
            console.error(err);
            process.exit(1);
        });
}

module.exports = { createTestData };